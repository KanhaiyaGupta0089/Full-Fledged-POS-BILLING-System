# Nixpacks configuration for Railway
# This tells Railway to use Python build properly
# Note: Nix Python is externally managed, so we use --break-system-packages flag

[phases.setup]
nixPkgs = ["python312", "curl"]

[phases.install]
cmds = [
  "curl -sS https://bootstrap.pypa.io/get-pip.py -o get-pip.py && python3 get-pip.py --break-system-packages && export PATH=\"$HOME/.local/bin:$PATH\" && python3 -m pip install --upgrade pip --break-system-packages && python3 -m pip install -r backend/requirements.txt --break-system-packages"
]

[phases.build]
cmds = [
  "cd backend && python3 manage.py migrate --noinput || true",
  "cd backend && python3 manage.py create_dummy_data || true",
  "cd backend && python3 manage.py collectstatic --noinput || true"
]

[start]
cmd = "cd backend && python3 -m gunicorn pos_system.wsgi:application --bind 0.0.0.0:$PORT"

